# 2025-12-12 개발일지

- 강의: [따라하며 배우는 NestJS](https://inf.run/jo7XN)

## 오늘 한 일

- **TypeORM 설정 분리 및 비동기 적용**

  - 기존 `app.module.ts`에 하드코딩 되어있던 DB 연결 정보를 `config/typeorm.config.ts` 파일로 분리했습니다.
  - `ConfigService`를 주입받아 `.env` 파일의 환경 변수를 동적으로 사용하도록 `TypeOrmModule.forRootAsync` 설정을 변경했습니다.
  - 이를 통해 설정의 재사용성과 유지보수성을 높였습니다.

  ```ts
  // src/config/typeorm.config.ts
  import { ConfigService } from "@nestjs/config";
  import { TypeOrmModuleOptions } from "@nestjs/typeorm";

  export const typeORMConfig = (
    configService: ConfigService
  ): TypeOrmModuleOptions => {
    return {
      type: "postgres",
      host: configService.get("DB_HOST"),
      port: Number(configService.get("DB_PORT")),
      username: configService.get("DB_USERNAME"),
      password: configService.get("DB_PASSWORD"),
      database: configService.get("DB_DATABASE"),
      autoLoadEntities: true,
      synchronize: true,
    };
  };
  ```

- **인증(Auth) 모듈 기본 구조 생성**

  - 사용자 인증 관련 기능을 담당할 `auth` 모듈과 하위 컨트롤러, 서비스를 Nest CLI를 이용해 생성했습니다.
  - `nest g module auth`
  - `nest g controller auth --no-spec`
  - `nest g service auth --no-spec`

- **회원가입 기능 구현 및 비밀번호 암호화**

  - `auth.service.ts`에 `signUp` 메서드를 구현하여 사용자 생성 로직을 추가했습니다.
  - `User` Entity의 `username` 필드에 `@Column({ unique: true })` 옵션을 추가하여 중복된 사용자가 가입할 수 없도록 처리했습니다.
  - 보안을 위해 `bcryptjs` 라이브러리를 사용하여 사용자의 비밀번호를 해싱하여 데이터베이스에 저장했습니다.

  ```bash
  npm install bcryptjs --save
  ```

  ```ts
  // src/auth/user.repository.ts (예시)
  async createUser(authCredentialsDto: AuthCredentialsDto): Promise<void> {
    const { username, password } = authCredentialsDto;

    const salt = await bcrypt.genSalt();
    const hashedPassword = await bcrypt.hash(password, salt);

    const user = this.create({ username, password: hashedPassword });

    try {
      await this.save(user);
    } catch (error) {
      if (error.code === '23505') { // unique-violation
        throw new ConflictException('Existing username');
      } else {
        throw new InternalServerErrorException();
      }
    }
  }
  ```

- **JWT 인증을 위한 패키지 설치**

  - Passport.js 기반의 JWT 인증 전략을 구현하기 위해 관련 라이브러리들을 설치했습니다.
  - `@nestjs/passport`, `passport`: NestJS에서 Passport를 쉽게 통합하고 사용하기 위한 모듈
  - `@nestjs/jwt`, `passport-jwt`: JWT 생성 및 검증, JWT 인증 전략 구현을 위한 모듈

  ```bash
  npm install @nestjs/jwt @nestjs/passport passport passport-jwt --save
  ```

## 정리

- 인증 기능의 기반을 마련하기 위해 `auth` 모듈을 생성하고, `TypeORM` 설정을 개선했습니다.
- `bcryptjs`를 이용해 안전하게 비밀번호를 암호화하여 저장하는 회원가입 기능을 구현했습니다.
- 다음 단계인 JWT를 이용한 로그인 기능과 인증 전략을 구현하기 위해 필요한 패키지들을 미리 설치했습니다.
